<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Project development </title>
  <meta name="description" content="GoalGoal of this final week is to document and build our final project, and track and document our progress">

  <link rel="stylesheet" href=" /css/main.css">
  <link rel="canonical" href=" /weeks/2015/06/03/class18.html">
  <link rel="alternate" type="application/rss+xml" title="Francesca Mereu" href=" /feed.xml" />
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href=" /">  <img src="/images/fotoblog.jpg" alt="mia foto" style="height:50px; margin-right:10px;"/>Francesca Mereu</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href=" /about/">About me</a>
          
        
          
          <a class="page-link" href=" /weeks/">Classes</a>
          
        
          
        
          
          <a class="page-link" href=" /project/">Final project</a>
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <div class="post">

  <header class="post-header"> 
 
    <h1 class="post-title">Project development </h1>
    <p class="post-meta">Jun 3, 2015</p>
  </header>

  <article class="post-content">
    <h1 id="goal">Goal</h1>
<p>Goal of this final week is to document and build our final project, and track and document our progress</p>

<p><img src="/images/esole4.jpg" alt="My helpful..screenshot" /></p>

<h2 id="project-results">Project results</h2>

<p>what tasks have been completed, and what tasks remain?</p>

<p>Completed:</p>

<pre><code>- building the pressure sensor
- designing and stuffing the board
- programming the board
- developing the interface
- designing the shoe and the module case
- license
</code></pre>

<p>Remained:</p>

<pre><code>- fabricate the shoe prototype by different materials
- connecting the bluetooth module and programming it
</code></pre>

<p>what has worked? </p>

<pre><code>- pressure textile sensor
- custom board
- web interface with websocket
</code></pre>

<p>what hasn’t?</p>

<pre><code>- web interface first version
- joint of the printed model
</code></pre>

<p>what questions need to be resolved?</p>

<pre><code>- how using the insole to interact with another device?
- how dissemination of project results to relevant stakeholders?
- Which "exploitation" plan, as business model definition?
</code></pre>

<p>what will happen when?</p>

<pre><code>I hope to wear this shoe on Fab11  
</code></pre>

<p>what have you learned?</p>

<pre><code>- manage a project in all parts of fabrication process;
- working all together 
- solving the problem in many cases
- working with electronic components
- share results and ideas
</code></pre>

<h2 id="specifications">Specifications</h2>

<p>For the final project presentation I managed to build a basic version of “Esole” with the following specifications:</p>

<ul>
  <li>silicon insole <br /></li>
  <li>custom pressure textile sensor <br /></li>
  <li>pressure board <br /></li>
  <li>sole case(shoes) with module for the board <br /></li>
  <li>serial connections</li>
  <li>web interface <br /></li>
  <li>Basic Python API for controlling the above   <br /></li>
</ul>

<p>The second version will have next addeds:</p>

<ul>
  <li>bluetooth module hc 05 <br /></li>
  <li>battery holder <br /></li>
  <li>flexible sole case <br /></li>
</ul>

<h2 id="architecture">Architecture</h2>

<p>The current prototype has the following architecture</p>

<p><img src="/images/shoe+mod1.jpg" alt="My helpful..screenshot" /></p>

<h2 id="parts-case-and-the-diy-sensor">Parts, Case and the DIY sensor</h2>

<p>The project is composed of a lot of parts: the insole with sensor, the board and the shoe-case with the module. The module is a case of the electronic components: as the board with the bluetooth module and the battery. When the sole is working the module is lighting.</p>

<p><img src="/images/esole1.jpeg" alt="My helpful..screenshot" /></p>

<h3 id="computer-aided-design--the-shoe-and--the-module">computer aided design:  the shoe and  the module</h3>

<p>As I ‘m designer is important for me to make a good design for the shoe and the electronic module.
I started from the concept of the heel  but in a second step I studied the insole and from it I build my shoes. 
I was modelling this part by  Rhinoceros and Sketchup, 3d computer graphics and computer aided design (CAD)applications software. Rhinoceros geometry is based on NURBS mathematical model, which focuses on producing mathematically precise rapresentation of curves and freeform surface in computer graphics. I prefered to use it for modelling the shoe, because I thinked to use Grasshopper, a  Rhino plug-in, to project parametrically the shoe case.</p>

<p><img src="/images/rhino1.jpeg" alt="My helpful..screenshot" />
<img src="/images/rhino2.jpeg" alt="My helpful..screenshot" /></p>

<h3 id="d-printing">3d printing</h3>

<p>The part of the packaging of the project is built with 3D printing and split in two parts: shoe and module,a little enclosure for the board and battery. Other parts don’t have any special requirements to be printed. 
Expect about 15 hours of printing to build the whole set at reasonable speed settings (i.e. 80mm/s). 
I used the WASP Delta 20x40. I made the insole in silicon rubber with a molding and casting technique, and the sensor with the velostat. 
The components to be printed are:</p>

<ul>
  <li>enclosure-shoe <br />    </li>
  <li>case-module for electronics <br /></li>
</ul>

<h1 id="setting-the-printing">Setting the printing</h1>

<p><img src="/images/curashoes.jpeg" alt="My helpful..screenshot" /></p>

<p><img src="/images/shoeprint1.jpeg" alt="My helpful..screenshot" /><img src="/images/shoeprint2.jpeg" alt="My helpful..screenshot" /></p>

<h3 id="molding-and-casting-the-insole">molding and casting: the insole</h3>

<p>The first step of the making process is to prepare the base of the smart insole by the molding and casting tecnique. Then I prepared a mold cutting a wood panel (4x200x300 mm) by the lasercutter . I used 50mm thick birch plywood, and design must be adjusted for different materials. The cutting power I used on the FullSpectrum 90W laser cutter is 40% power 100% speed.</p>

<p><img src="/images/laser insole.jpg" alt="My helpful..screenshot" /></p>

<p>I used the silicone-rubber of “Smooth on”, in part of 150 g of part A and 5% of part B</p>

<p><img src="/images/insole3.jpg" alt="My helpful..screenshot" /></p>

<p><img src="/images/insole4.jpg" alt="My helpful..screenshot" /></p>

<h3 id="computer-controlled-cutting-sticker-logo">computer controlled cutting: sticker logo</h3>

<p>To signalize the sole with the sensor I thinked to also prepared some stickers with logo, allowing to customize the products case and have a good design look.</p>

<p><img src="/images/vinyl-esole.png" alt="My helpful..screenshot" /></p>

<h3 id="input-device-analog-textile-pressure-sensor">Input device: analog textile pressure sensor</h3>

<p>I used Velostat/Linqstat (Carbon impregnated Polyethylene film ) and a conductive fabric to make an analog pressure sensor. 
Velostat is a piezoresistive material, meaning it’s electrical resistance decreases when pressure. It’s pressure-sensitive: squeezing it will reduce the resistance, so it’s handy for making flexible sensors. When sandwiched between two conductive layers, it has a wonderful range for making pressure and bend sensors. It can also be used for position sensing. </p>

<p><img src="/images/textile.jpg" alt="My helpful..screenshot" /></p>

<p>This analog press button works with resistive principle. It has a very high resistivity when not pressed, but its resistance goes down as soon as you press it. It works as a bend sensor as well.
By connecting more sensors together it is possible to make a matrix analog switch.</p>

<p><img src="/images/insole5.jpg" alt="My helpful..screenshot" />
<img src="/images/esole-sensor.jpeg" alt="My helpful..screenshot" /></p>

<p>The Analog textile pressbutton is a analog textile sensor that change his resistivity if you make pressure on it. It is useful for creating variable voltage divider that can be easily read by an Arduino.</p>

<p><img src="/images/insole-pressure.png" alt="My helpful..screenshot" /></p>

<h3 id="testing-the-sensor-part1">Testing the sensor (part1)</h3>

<p>So, first I tested the sensor with lilypad arduino, afterwards I tested it with my board.
There’s the code that I used:</p>

<pre><code>Int SensorPin = a5;    // Select the Input pin for the Sensor
Int LedPin = 13;      // Select the pin for the LED
Int SensorValue = 0;  // Variable to Store the Value Coming from the Sensor
  
Void Setup() {
  // Declare the LedPin as an OUTPUT:
  PinMode(LedPin, OUTPUT);
}
  
Void Loop() {
  // Read the Value from the Sensor:
  SensorValue = AnalogRead(SensorPin);
  // Turn the LedPin On
  DigitalWrite(LedPin, HIGH);
  // Stop the Program for &lt;SensorValue&gt; Milliseconds:
  Delay(SensorValue);
  // Turn the LedPin Off:
  DigitalWrite(LedPin, LOW);
  // Stop the Program for for &lt;SensorValue&gt; Milliseconds:
  Delay(SensorValue);
}
</code></pre>

<h2 id="electronic-design-press-board">electronic design: “press-board”</h2>

<p>This analog press button works with resistive principle. I designed the pressboard considerating three pins: two for the sensor (press1 and press2) and another for the VCC. These are the images of the schematic board from Eagle cad and the soldered board.</p>

<p><img src="/images/pressboard.png" alt="My helpful..screenshot" /> <img src="/images/board.jpg" alt="My helpful..screenshot" /></p>

<h3 id="testing-the-sensor-part2">Testing the sensor (part2)</h3>

<p><img src="/images/insole1.jpg" alt="My helpful..screenshot" /></p>

<p>Finally I have programed the board in C. This is the code:</p>

<p>In the first part I defined the macro</p>

<pre><code> #include &lt;avr/io.h&gt;
 #include &lt;util/delay.h&gt;

 #define output(directions,pin) (directions |= pin) // set port direction for output
 #define set(port,pin) (port |= pin) // set port pin
 #define clear(port,pin) (port &amp;= (~pin)) // clear port pin
 #define pin_test(pins,pin) (pins &amp; pin) // test for port pin
 #define bit_test(byte,bit) (byte &amp; (1 &lt;&lt; bit)) // test for bit set
 #define bit_delay_time 100 // bit delay for 9600 with overhead
 #define bit_delay() _delay_us(bit_delay_time) // RS232 bit delay
 #define half_bit_delay() _delay_us(bit_delay_time/2) // RS232 half bit delay
 #define char_delay() _delay_ms(10) // char delay

 #define serial_port PORTA
 #define serial_direction DDRA
 #define serial_pin_out (1 &lt;&lt; PA1) // pin Tx serial 
 // write a char into a serial port
</code></pre>

<p>In this part it send character in txchar on port pin</p>

<pre><code>void put_char(volatile unsigned char *port, unsigned char pin, char txchar) {
&lt;	//
	// send character in txchar on port pin
	//	 assumes line driver (inverts bits)
	//
	// start bit
	//
	clear(*port,pin);
	bit_delay();
	//
	// unrolled loop to write data bits
	//
	if bit_test(txchar,0)
		set(*port,pin);
	else
		clear(*port,pin);
	bit_delay();
	if bit_test(txchar,1)
		set(*port,pin);
	else
		clear(*port,pin);
	bit_delay();
	if bit_test(txchar,2)
		set(*port,pin);
	else
		clear(*port,pin);
	bit_delay();
	if bit_test(txchar,3)
		set(*port,pin);
	else
		clear(*port,pin);
	bit_delay();
	if bit_test(txchar,4)
		set(*port,pin);
	else
		clear(*port,pin);
	bit_delay();
	if bit_test(txchar,5)
		set(*port,pin);
	else
		clear(*port,pin);
	bit_delay();
	if bit_test(txchar,6)
		set(*port,pin);
	else
		clear(*port,pin);
	bit_delay();
	if bit_test(txchar,7)
		set(*port,pin);
	else
		clear(*port,pin);
	bit_delay();
	//
	// stop bit
	//
	set(*port,pin);
	bit_delay();
	//
	// char delay
	//
	bit_delay();
}&gt;
</code></pre>

<p>In this part we read the sensor value on pin 1</p>

<pre><code>// read sensor value
	void readsensor1(){
	   	static char chr;
		   //initialize ADC 
		   // init A/D
		   //
		   ADMUX =  (0 &lt;&lt; REFS1) | (0 &lt;&lt; REFS0) // Vcc ref
		      | (0 &lt;&lt; ADLAR) // right adjust
		      | (0 &lt;&lt; MUX5) | (0 &lt;&lt; MUX4) | (0 &lt;&lt; MUX3) | (0 &lt;&lt; MUX2) | (1 &lt;&lt; MUX1) | (1 &lt;&lt; MUX0); // ADC3 -configure pin
		   ADCSRA = (1 &lt;&lt; ADEN) // enable
		      | (1 &lt;&lt; ADPS2) | (1 &lt;&lt; ADPS1) | (1 &lt;&lt; ADPS0); // prescaler /128
		   //
	       //
	       // initiate conversion
	       //
	       ADCSRA |= (1 &lt;&lt; ADSC);
	       //
	       // wait for completion
	       //
	       while (ADCSRA &amp; (1 &lt;&lt; ADSC)){ // while adsc not 0
			   // nothing
	
   }
   //
   // send result
   //
   chr = ADCL;
   put_char(&amp;serial_port, serial_pin_out, chr);
   char_delay();
   chr = ADCH;
   put_char(&amp;serial_port, serial_pin_out, chr);
   char_delay();
   }
</code></pre>

<p>In this part we read the sensor value on pin2</p>

<pre><code>void readsensor2(){
   	static char chr;
	   //
	   // init A/D
	   //
	   ADMUX =  (0 &lt;&lt; REFS1) | (0 &lt;&lt; REFS0) // Vcc ref
	      | (0 &lt;&lt; ADLAR) // right adjust
	      | (0 &lt;&lt; MUX5) | (0 &lt;&lt; MUX4) | (0 &lt;&lt; MUX3) | (0 &lt;&lt; MUX2) | (1 &lt;&lt; MUX1) | (0 &lt;&lt; MUX0); //  ADC2
	   ADCSRA = (1 &lt;&lt; ADEN) // enable
	      | (1 &lt;&lt; ADPS2) | (1 &lt;&lt; ADPS1) | (1 &lt;&lt; ADPS0); // prescaler /128
	   //
       //
       // initiate conversion
       //
       ADCSRA |= (1 &lt;&lt; ADSC);
       //
       // wait for completion
       //
       while (ADCSRA &amp; (1 &lt;&lt; ADSC))
          ;
       //
       // send result
       //
       chr = ADCL;
       put_char(&amp;serial_port, serial_pin_out, chr);
       char_delay();
       chr = ADCH;
       put_char(&amp;serial_port, serial_pin_out, chr);
       char_delay();

   }



int main(void) {
   //
   // main
   //   
   //
   // set clock divider to /1
   //
   CLKPR = (1 &lt;&lt; CLKPCE);
   CLKPR = (0 &lt;&lt; CLKPS3) | (0 &lt;&lt; CLKPS2) | (0 &lt;&lt; CLKPS1) | (0 &lt;&lt; CLKPS0);
   //
   // initialize output pins
   //
  set(serial_port, serial_pin_out);
  output(serial_direction, serial_pin_out);  
   // main loop
   //
   while (1) {
      //
  // send framing
  //
  put_char(&amp;serial_port, serial_pin_out, 1);
  char_delay();
  put_char(&amp;serial_port, serial_pin_out, 2);
  char_delay();
  put_char(&amp;serial_port, serial_pin_out, 3);
  char_delay();
  put_char(&amp;serial_port, serial_pin_out, 4);
  char_delay();
  readsensor1();
  readsensor2();
  //put_char(&amp;serial_port, serial_pin_out,'\n');   } }
</code></pre>

<p>The software setup on the ATtiny44 can be easily done using the fabisp to program the Pressboard: </p>

<pre><code>make press.out
make press.hex
make program-usbtiny 
</code></pre>

<p><img src="/images/esole-embedded.jpeg" alt="My helpful..screenshot" /></p>

<h1 id="interface-and-application-websocket-on-pyton--web">Interface and application: websocket on Pyton- web</h1>

<p><img src="/images/localhost.jpg" alt="My helpful..screenshot" /></p>

<p>For Esole I write an interface using Javascript, a programming language of HTML and the Web, integrating with Raphael vector library to insert the svg and websocket, using the tutorial in the FabAcademy Archive (http://fabacademy.org/archives/2015/doc/WebSocketConsole.html) to communicate with the local server. I describe all parts of the working progress on my class page <a href="http://mereufrance77.github.io/classes/interfaceandapplicationprogramming"> Github </a><br /></p>

<p>The complete demo looks like the following:</p>

<p><a href="https://vimeo.com/131591114">esole-video</a></p>

<h2 id="downloads">Downloads</h2>

<p>-<a href="/files/week18/PressureS.brd"> eagle </a><br />
-<a href="/files/week18/sensorPress-bordi.png"> mill </a><br />
-<a href="/files/week18/SensorPress-etching.png"> mill </a><br />
-<a href="/files/week18/makefile"> Press </a><br />
-<a href="/files/week18/press.c"> Press </a><br />
-<a href="/files/week18/scarpa 12 con mol.3ds"> shoe+case model </a><br />
-<a href="/files/week18/scarpa12.stl"> shoe+case printed </a><br />
-<a href="/files/week18/vinyllogo-esole.png"> sticker </a><br /></p>


  </article>

</div>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Francesca Mereu</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col  footer-col-1">
        <ul class="contact-list">
          <!-- <li>Francesca Mereu</li> -->
          <li><a href="mailto:martech.platform@gmail.com">martech.platform@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col  footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/mereufrance77">
              <span class="icon  icon--github">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/>
                </svg>
              </span>

              <span class="username">mereufrance77</span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/M-Artech">
              <span class="icon  icon--twitter">
                <svg viewBox="0 0 16 16">
                  <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                  c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                </svg>
              </span>

              <span class="username">M-Artech</span>
            </a>
          </li>
          
        </ul>
      </div>

      <div class="footer-col  footer-col-3">
        <p class="text">This a FabAcademy 2015 website. There are all processes of my work, experiments,  prototypes..
</p>
                 
      </div>
    </div>
 <p class="rss-subscribe">subscribe <a href=" /feed.xml">via RSS</a></p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License"   style="border-width:0"     src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />This work by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Francesca Mereu</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.

  </div>
</footer>


  </body>

</html>
